<div class="organizations-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-title">
      <h1>سازمان‌های شهرداری</h1>
      <p>مدیریت سازمان‌های مربوط به شهرداری</p>
    </div>
    <div class="header-actions">
      <div class="dark-search-input">
        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconSearch">
          <input type="text" nz-input placeholder="جستجوی سازمان‌ها..." />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <span nz-icon nzType="search"></span>
        </ng-template>
      </div>
      <button
        nz-button
        nzType="primary"
        nzShape="round"
        (click)="showAssignmentModal()"
      >
        <span nz-icon nzType="user-add"></span>
        اختصاص مسئول
      </button>
      <button
        nz-button
        nzType="primary"
        nzShape="round"
        (click)="showOrganizationModal()"
      >
        <span nz-icon nzType="plus"></span>
        سازمان جدید
      </button>
    </div>
  </div>

  <!-- Organizations Table Card -->
  <div class="custom-card">
    <div class="custom-card__header">
      <h2 class="custom-card__title">لیست سازمان‌ها</h2>
      <p class="custom-card__subtitle">تمام سازمان‌های تعریف شده در سیستم</p>
    </div>
    <div class="custom-card__body">
      <nz-table
        #organizationsTable
        [nzData]="organizations"
        [nzSize]="'middle'"
        class="financial-table"
      >
        <thead>
          <tr>
            <th>نام سازمان</th>
            <th class="actions-header">عملیات</th>
          </tr>
        </thead>
        <tbody>
          @for (org of organizations; track org.id) {
          <tr>
            <td>{{ org.name }}</td>
            <td class="actions">
              <button nz-button nzShape="round" nzType="primary" nzSize="small">
                ویرایش
              </button>
              <button
                nz-button
                nzDanger
                nzShape="round"
                nzType="primary"
                nzSize="small"
                nz-popconfirm
                nzPopconfirmTitle="آیا از حذف این سازمان مطمئن هستید؟"
                (nzOnConfirm)="deleteOrganization(org.id)"
              >
                حذف
              </button>
            </td>
          </tr>
          }
        </tbody>
      </nz-table>
    </div>
  </div>
</div>

<!-- Modal for Adding a New Organization -->
<nz-modal
  [(nzVisible)]="isOrganizationModalVisible"
  nzTitle="سازمان جدید"
  (nzOnCancel)="handleOrganizationCancel()"
  (nzOnOk)="handleOrganizationOk()"
  [nzOkText]="'ذخیره'"
  [nzCancelText]="'انصراف'"
>
  <ng-container *nzModalContent>
    <p class="modal-subtitle">سازمان جدیدی به سیستم اضافه کنید.</p>
    <form nz-form [formGroup]="organizationForm" class="modal-form">
      <nz-form-item>
        <nz-form-label nzRequired>نام سازمان</nz-form-label>
        <nz-form-control nzErrorTip="لطفا نام سازمان را وارد کنید">
          <input
            nz-input
            formControlName="name"
            placeholder="مثال: سازمان حمل و نقل"
          />
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>

<!-- Modal for Assigning a Person to an Organization -->
<nz-modal
  [(nzVisible)]="isAssignmentModalVisible"
  nzTitle="اختصاص مسئول به سازمان"
  (nzOnCancel)="handleAssignmentCancel()"
  (nzOnOk)="handleAssignmentOk()"
  [nzOkText]="'ذخیره'"
  [nzCancelText]="'انصراف'"
>
  <ng-container *nzModalContent>
    <p class="modal-subtitle">یک مسئول به سازمان مورد نظر اختصاص دهید.</p>
    <form nz-form [formGroup]="assignmentForm" class="modal-form">
      <nz-form-item>
        <nz-form-label nzRequired>سازمان</nz-form-label>
        <nz-form-control nzErrorTip="لطفا سازمان را انتخاب کنید">
          <nz-select
            formControlName="organizationId"
            nzPlaceHolder="سازمان را انتخاب کنید"
          >
            @for(org of organizations; track org.id) {
            <nz-option [nzValue]="org.id" [nzLabel]="org.name"></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired>کاربر</nz-form-label>
        <nz-form-control nzErrorTip="لطفا کاربر را انتخاب کنید">
          <nz-select
            formControlName="userId"
            nzPlaceHolder="کاربر را انتخاب کنید"
          >
            @for(person of persons; track person.id) {
            <nz-option
              [nzValue]="person.id"
              [nzLabel]="person.name + ' ' + person.family"
            ></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired>نوع سمت</nz-form-label>
        <nz-form-control nzErrorTip="لطفا نوع سمت را انتخاب کنید">
          <nz-select
            formControlName="jobPostTypeId"
            nzPlaceHolder="نوع سمت را انتخاب کنید"
          >
            @for(postType of jobPostTypes; track postType.id) {
            <nz-option
              [nzValue]="postType.id"
              [nzLabel]="postType.name"
            ></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired>شماره تلفن</nz-form-label>
        <nz-form-control nzErrorTip="لطفا شماره تلفن را وارد کنید">
          <input
            nz-input
            formControlName="phoneNumber"
            placeholder="مثال: 09123456789"
          />
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>
