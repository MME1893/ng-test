<div class="companies-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-title">
      <h1>شرکت‌های شهرداری</h1>
      <p>مدیریت شرکت‌های مربوط به شهرداری</p>
    </div>
    <div class="header-actions">
      <div class="dark-search-input">
        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconSearch">
          <input type="text" nz-input placeholder="جستجوی شرکت‌ها..." />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <span nz-icon nzType="search"></span>
        </ng-template>
      </div>
      <button
        nz-button
        nzType="primary"
        nzShape="round"
        (click)="showAssignmentModal()"
      >
        <span nz-icon nzType="user-add"></span>
        اختصاص مسئول
      </button>
      <button
        nz-button
        nzType="primary"
        nzShape="round"
        (click)="showCompanyModal()"
      >
        <span nz-icon nzType="plus"></span>
        شرکت جدید
      </button>
    </div>
  </div>

  <!-- Companies Table Card -->
  <div class="custom-card">
    <div class="custom-card__header">
      <h2 class="custom-card__title">لیست شرکت‌ها</h2>
      <p class="custom-card__subtitle">تمام شرکت‌های تعریف شده در سیستم</p>
    </div>
    <div class="custom-card__body">
      <nz-table
        #companiesTable
        [nzData]="companies"
        [nzSize]="'middle'"
        class="financial-table"
      >
        <thead>
          <tr>
            <th>نام شرکت</th>
            <th class="actions-header">عملیات</th>
          </tr>
        </thead>
        <tbody>
          @for (comp of companies; track comp.id) {
          <tr>
            <td>{{ comp.name }}</td>
            <td class="actions">
              <button nz-button nzShape="round" nzType="primary" nzSize="small">
                ویرایش
              </button>
              <button
                nz-button
                nzDanger
                nzShape="round"
                nzType="primary"
                nzSize="small"
                nz-popconfirm
                nzPopconfirmTitle="آیا از حذف این شرکت مطمئن هستید؟"
                (nzOnConfirm)="deleteCompany(comp.id)"
              >
                حذف
              </button>
            </td>
          </tr>
          }
        </tbody>
      </nz-table>
    </div>
  </div>
</div>

<!-- Modal for Adding a New Company -->
<nz-modal
  [(nzVisible)]="isCompanyModalVisible"
  nzTitle="شرکت جدید"
  (nzOnCancel)="handleCompanyCancel()"
  (nzOnOk)="handleCompanyOk()"
  [nzOkText]="'ذخیره'"
  [nzCancelText]="'انصراف'"
>
  <ng-container *nzModalContent>
    <p class="modal-subtitle">شرکت جدیدی به سیستم اضافه کنید.</p>
    <form nz-form [formGroup]="companyForm" class="modal-form">
      <nz-form-item>
        <nz-form-label nzRequired>نام شرکت</nz-form-label>
        <nz-form-control nzErrorTip="لطفا نام شرکت را وارد کنید">
          <input
            nz-input
            formControlName="name"
            placeholder="مثال: شرکت آب و فاضلاب"
          />
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>

<!-- Modal for Assigning a Person to a Company -->
<nz-modal
  [(nzVisible)]="isAssignmentModalVisible"
  nzTitle="اختصاص مسئول به شرکت"
  (nzOnCancel)="handleAssignmentCancel()"
  (nzOnOk)="handleAssignmentOk()"
  [nzOkText]="'ذخیره'"
  [nzCancelText]="'انصراف'"
>
  <ng-container *nzModalContent>
    <p class="modal-subtitle">یک مسئول به شرکت مورد نظر اختصاص دهید.</p>
    <form nz-form [formGroup]="assignmentForm" class="modal-form">
      <nz-form-item>
        <nz-form-label nzRequired>شرکت</nz-form-label>
        <nz-form-control nzErrorTip="لطفا شرکت را انتخاب کنید">
          <nz-select
            formControlName="companyId"
            nzPlaceHolder="شرکت را انتخاب کنید"
          >
            @for(comp of companies; track comp.id) {
            <nz-option [nzValue]="comp.id" [nzLabel]="comp.name"></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired>کاربر</nz-form-label>
        <nz-form-control nzErrorTip="لطفا کاربر را انتخاب کنید">
          <nz-select
            formControlName="userId"
            nzPlaceHolder="کاربر را انتخاب کنید"
          >
            @for(person of persons; track person.id) {
            <nz-option
              [nzValue]="person.id"
              [nzLabel]="person.name + ' ' + person.family"
            ></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired>نوع سمت</nz-form-label>
        <nz-form-control nzErrorTip="لطفا نوع سمت را انتخاب کنید">
          <nz-select
            formControlName="jobPostTypeId"
            nzPlaceHolder="نوع سمت را انتخاب کنید"
          >
            @for(postType of jobPostTypes; track postType.id) {
            <nz-option
              [nzValue]="postType.id"
              [nzLabel]="postType.name"
            ></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired>شماره تلفن</nz-form-label>
        <nz-form-control nzErrorTip="لطفا شماره تلفن را وارد کنید">
          <input
            nz-input
            formControlName="phoneNumber"
            placeholder="مثال: 09123456789"
          />
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>
